
@{
    ViewBag.Title = "Index";
}

@using Entity.ViewModels
@model UsersConhecerPessoas

@section PageLevelPluginStyles{
    <link href="~/assets/global/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />

    <link href="~/assets/global/plugins/fancybox/source/jquery.fancybox.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/admin/pages/css/portfolio.css" rel="stylesheet" type="text/css" />

    <link href="~/assets/admin/pages/css/news.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/admin/pages/css/blog.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/global/plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/global/plugins/bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" type="text/css" />
}

<div class="portlet solid purple">
    <div class="portlet-title">
        <div class="caption">
            <i class="fa fa-sliders fa-4x"></i>Filtros
        </div>
        <div class="tools">
            <a href="javascript:;" class="expand" data-original-title="" title="Abrir/fechar filtros">
            </a>
        </div>
    </div>
    <div class="portlet-body" style="display: none;">
        @using (Html.BeginForm("Index", "Conhecer", FormMethod.Post))
        {
            <div class="form-body">
                <div class="row">
                    <div class="form-group col-md-3">
                        <label>Mínimo de Tags em comum</label>
                        <select class="form-control" name="tagsComum">
                            @for (int i = 1; i <= 5; i++)
                            {
                                string selected = Model.NumeroTagsComum == i ? "selected=\"selected\"" : null;
                                <option @selected value="@i">@i</option>
                            }
                        </select>
                    </div>

                    <div class="form-group col-md-2">
                        <label> Idade mínima</label>
                        <select id="seletor-idade-minima" class="form-control" name="idadeMin">
                            @for (int i = 18; i <= 79; i++)
                            {
                                string selected = Model.IdadeMinima == i ? "selected=\"selected\"" : null;
                                <option @selected value="@i">@i</option>
                            }
                        </select>
                        <label>Idade máxima</label>
                        <select id="seletor-idade-maxima" class="form-control" name="idadeMax"></select>
                    </div>

                    <div class="form-group col-md-3">
                        <label>Resultados por página</label>
                        <select class="form-control" name="qntPorPagina">
                            @for (int i = 15; i <= 35; i += 10)
                            {
                                string selected = Model.QtdPessoasPagina == i ? "selected=\"selected\"" : null;
                                <option @selected value="@i">@i</option>
                            }
                        </select>
                    </div>

                    <div class="form-group col-md-3">
                        <label>Colunas</label>
                        <select class="form-control" name="colunas">
                            @for (int i = 4; i >= 2; i--)
                            {
                                string selected = Model.NumeroColunas == i ? "selected=\"selected\"" : null;
                                <option @selected value="@i">@i</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <div class="col-md-offset-9">
                    <input type="submit" class="btn btn-lg default-roxocustomizado purple-customizado" value="Aplicar filtros" />
                </div>
            </div>
        }

    </div>
</div>
<!--pessoas encontradas -->
@Html.Partial("CardsUsuarios", Model)



@section  PageLevelPlugins
{
    <script type="text/javascript" src="~/assets/global/plugins/jquery-mixitup/jquery.mixitup.min.js"></script>
    <script type="text/javascript" src="~/assets/global/plugins/fancybox/source/jquery.fancybox.pack.js"></script>

    <script src="~/assets/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
    <script src="~/assets/global/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>
}

@section PageLevelScripts {
    <script src="~/assets/admin/pages/scripts/portfolio.js"></script>
    <script src="~/assets/global/plugins/gmaps/gmaps.js"></script>
    <script src="~/assets/global/plugins/gmaps/gmaps.min.js"></script>
}

@section JqueryFinal{
    <script>
        jQuery(document).ready(function () {
            Metronic.init(); // init metronic core components
            Layout.init(); // init current layout
            Demo.init(); // init demo features  // set current page
            Portfolio.init();
            getLocation();
            carregarIdadesMaximas();
        });

        $('#seletor-idade-minima').change(carregarIdadesMaximas);

        function carregarIdadesMaximas() {
            var maximaAnterior = @Model.IdadeMaxima;
            $('#seletor-idade-maxima').empty();
            var idade = $('#seletor-idade-minima').find(':selected').val();
            var idademin = ++idade;
            for (var i = idademin; i <= 80; i++) {
                var opt = $('<option>').val(i).text(i);
                if (i == maximaAnterior) {
                    opt.attr('selected','selected');
                }
                $('#seletor-idade-maxima').append(opt);
            }
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            }
        }
        function showPosition(position) {

            var lat = position.coords.latitude;
            var lon = position.coords.longitude;
            $.ajax({
                url: '/Conhecer/SalvarCoordenadas',
                type: 'POST',
                data: JSON.stringify({ Latitude: lat, Longitude: lon }),
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    //alert(data);
                },
                error: function (request, status, error) {
                    //alert('oh, errors here. The call to the server is not working.')
                }
            });

        }
    </script>
    <script>
        $('.ver-perfil-detalhado').click(function () {
            var $divCard = $(this).parent().parent().parent();
            var userID = $divCard.attr('id').replace("user", '');

            $.ajax({
                url: '/Conhecer/GetUser',
                type: 'POST',
                data: JSON.stringify({ id: userID }),
                contentType: "application/json;charset=utf-8",
                dataType: 'json',
                success: function (result) {
                    if (result.sucesso) {
                        inserirUserNoModal(result);
                    } else {
                        // mostrarAlerta(result.mensagem, 'danger');
                    }
                },
                error: function (request, status, error) {
                    //mostrarAlerta('Algo de errado ocorreu.', 'danger');
                }
            });
            console.log(userID);
        });
        function inserirUserNoModal(result) {
            $('#stack1 #nome').text(result.nome);
            $('#stack1 #idade').text(result.idade);
            $('#stack1 #foto').attr('src', result.foto);
            $('#stack1 #frase-apresentacao').text(result.frase);
            $('#stack1 #descricao').text(result.descricao);

            $(result.tags).each(function (i) {
                var iclass = '<i class="fa fa-tags"></i>' + this;
                $('#stack1 #tags').append(iclass);
            });

            @* <i class="fa fa-tags"></i>tag *@
        }

    </script>
}